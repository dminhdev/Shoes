<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      th:replace="~{/layout/layout :: main-fragment(
                                                                     ~{:: title},
                                                                    'header',
                                                                    'footer',
                                                                     ~{:: #css-resources},
                                                                     ~{:: #js-resources},
                                                                     ~{:: #main-content}
                                                                    )}">
<head>
    <meta charset="UTF-8">
    <title>Thông tin giỏ hàng</title>
    <th:block id="css-resources">
        <style>
            .main-content .nav {
                grid-template-columns: 1fr 1fr 1fr 1fr 1fr;
            }

            @media (max-width: 767px) {
                .main-content .nav {
                    display: flex;
                    flex-wrap: nowrap;
                    overflow: scroll;
                }
                .main-content .nav-item {
                    white-space: nowrap;
                }
            }
        </style>
        <link rel="stylesheet" th:href="@{/shop/css/custom.css}">
    </th:block>
</head>
<body>
<main id="main-content" class="container">
    <div class="row">
        <div class="col-lg-8 main-content-wrapper">
            <div class="main-content">
                <th:block th:each="item : ${ListcartItems}">
                    <div class="list-itemcart">

                        <div class="itemcart-info col-md-12">
                            <div class="row">
                                <div class="checkItem col-md-1"><input class="form-check-input checkItem" type="checkbox" value=""></div>
                                <div class="product-image col-md-2"><img th:src="@{${item.product_id.images[0]}}" style="width: 80px;height: 80px"></div>
                                <div class="col-md-3 cart-product-info">
                                    <div class="product-name" th:text="${item.product_id.name}"></div>
                                    <div class="product-size" th:text="${'size: '+item.size}"></div>
                                </div>
                                <div class="product-quantity col-md-3" th:text="${'x'+item.quantity}"></div>
                                <div class="product-price col-md-2" th:text="${item.product_id.salePrice}"></div>

                                <div class="actions col-md-1">
                                    <a href="#" th:data-id="${item.id}" class="on-default remove-row delete-product"><i class="far fa-trash-alt"></i></a>
                                </div>
                            </div>
                        </div>
                    </div>
                </th:block>
                <br>
                <!-- Pagination -->
                <nav aria-label="Page navigation">
                    <ul class="pagination" id="pagination"></ul>
                </nav>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="pricing childs">
                <div class="coupon price-include">
                    <div class="text">Tạm tính</div>
                    <input class="form-control text-price-input" id="in-price" type="text" readonly/>
                </div>
                <div class="coupon price-include">
                    <div class="text">Khuyến mãi</div>
                    <input class="form-control text-price-input" id="in-promotion-value" type="text" readonly/>
                </div>
                <div class="coupon price-include">
                    <div class="text">Tổng thanh toán</div>
                    <input class="form-control text-price-input" id="in-total-price" type="text" readonly/>
                </div>
            </div>
            <div class="float-right">
                <a href="/san-pham">
                    <button class="btn btn-secondary confirm-btn">Tiếp tục mua hàng</button>
                </a>
                <button type="button" class="btn btn-primary confirm-btn red-btn" id="btn-buy-now">ĐẶT HÀNG </button>
            </div>
        </div>
    </div>
</main>

<th:block id="js-resources">
    <script type="text/javascript" th:src="@{/adminlte/js/table.js}"></script>
    <script>
        $('.buy-now').click(function() {
            if (isLogined == true) {
                //let quantity = $('#quantity-product').val();

            } else {
                toastr.warning("Vui lòng đăng nhập để đặt hàng");
                setTimeout(function() {
                    $('#exampleModal').modal('show');
                }, 500);
            }
        })
        function warningBeforeDelete(){
            swal({
                title: "Xác nhận xóa",
                text: "Bạn có chắc chắn muốn xóa hay không",
                type: "warning",
                showCancelButton: true,
                confirmButtonClass: "btn-success",
                cancelButtonClass: "btn-danger",
                confirmButtonText: "Xác nhận",
                cancelButtonText: "Hủy bỏ",
            }).then(function(isConfirm) {
                if (isConfirm.value) {
                    var ids = $('tbody input[type=checkbox]:checked').map(function () {
                        return $(this).val();
                    }).get();
                    deleteNew(ids);
                }
            });
        }
        function deleteNew(data) {
            $.ajax({
                url: '/api/cart/delete',
                type: 'DELETE',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function (data){
                    toastr.success("Xóa sản phẩm thành công!");
                    setTimeout(() => location.reload(), 500);
                },
                error: function (error){
                    toastr.warning(error.responseJSON.message);
                }
            });
        }

        $(".delete-product").on("click",function (){
            let id = $(this).data('id');
            swal({
                title: 'Bạn chắc chắn muốn xóa sản phẩm khỏi giỏ hàng!',
                type: 'warning',
                showCancelButton: true,
                confirmButtonColor: "#e24d55",
                cancelButtonText: "Không",
                confirmButtonText: "Có",
            }).then(function (rs){
                if (rs.value){
                    $.ajax({
                        url:"/api/cart/delete/"+ id,
                        type: "DELETE",
                        success: function (data){
                            toastr.success("Xóa sản phẩm thành công!");
                            setTimeout(() => location.reload(), 500);
                        },
                        error: function (error){
                            toastr.warning(error.responseJSON.message);
                        }
                    })
                }
            })
        })
    </script>
</th:block>
</body>
</html>